{"mappings":"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","sources":["src/background/service_worker.ts","src/background/page-scripts/index.ts","src/background/page-scripts/queryTracking.ts","src/background/page-scripts/selectElements.ts","src/background/page-scripts/sliceHtml.ts","src/background/page-scripts/tracking.ts"],"sourcesContent":["import * as scripts from \"./page-scripts\";\n\n/**\n * Executes a function in the context of the page corresponding to a tabId.\n * \n * @param tabId Specifies the tab in which to execute the function.\n * @param func A reference to a function to execute in the context of the page.\n * @param args Optional arguments to pass to the function.\n * @returns The result returned by the function. If the resulting value of the function execution is a promise, Chrome will wait for the promise to settle and return the resulting value. {@link https://developer.chrome.com/docs/extensions/reference/scripting/#promises}\n * @see {@link https://developer.chrome.com/docs/extensions/reference/scripting/#runtime-functions}\n */\nfunction executeScript<T = unknown>(tabId: number, func: () => void, ...args: any): Promise<T | void> {\n    return new Promise(resolve =>\n        chrome.scripting.executeScript(\n            { target: { tabId }, func, args },\n            results => {\n                // The results of executing JavaScript are passed to the extension. A single result is included per-frame. The main frame is guaranteed to be the first index in the resulting array; all other frames are in a non-deterministic order.\n                if (results instanceof Array && results.length > 0)\n                    resolve(results[0].result); // only take the first frame result for now\n                else if (chrome.runtime.lastError) // avoids error \"Unchecked runtime.lastError: Exactly one of 'func' and 'files' must be specified\"\n                    console.warn(chrome.runtime.lastError.message); // https://stackoverflow.com/questions/28431505/unchecked-runtime-lasterror-when-using-chrome-api\n                else\n                    resolve();\n            }\n        )\n    );\n}\n\n/**\n * Executes a script in the context of the page corresponding to a tabId.\n * Also used to inject a library such as jQuery so it can be called subsequently.\n * \n * @param tabId Specifies the tab in which to execute the script.\n * @param file A file containing the script to execute in the context of the page.\n * @returns The result returned by executing the script.\n * @see {@link https://developer.chrome.com/docs/extensions/reference/scripting/#runtime-functions}\n */\nfunction executeScriptFile<T = unknown>(tabId: number, file: string): Promise<T> {\n    return new Promise((resolve, reject) =>\n        chrome.scripting.executeScript(\n            { target: { tabId }, files: [file] },\n            results => {\n                // The results of executing JavaScript are passed to the extension. A single result is included per-frame. The main frame is guaranteed to be the first index in the resulting array; all other frames are in a non-deterministic order.\n                if (results instanceof Array && results.length > 0)\n                    resolve(results[0].result); // only take the first frame result for now\n                else if (chrome.runtime.lastError) // avoids error \"Unchecked runtime.lastError: Exactly one of 'func' and 'files' must be specified\"\n                    console.warn(chrome.runtime.lastError.message); // https://stackoverflow.com/questions/28431505/unchecked-runtime-lasterror-when-using-chrome-api\n                else\n                    reject({ message: `Failed to execute script file ${file}` });\n            }\n        )\n    );\n}\n\nasync function injectAll(tabId: number): Promise<void> {\n    const injected = await executeScript<boolean>(tabId, () => typeof window.syphonx === \"object\");\n    if (!injected) {\n        //await executeScriptFile(tabId, \"jquery.slim.js\");\n        //await executeScriptFile(tabId, \"syphonx.js\");\n        await executeScript(tabId, () => (window as {syphonx: {}}).syphonx = {}); // set inclusion guard\n        await chrome.scripting.insertCSS({ target: { tabId }, files: [\"syphonx.css\"] });\n        //console.log(`BACKGROUND sx injected tabId=${tabId}`);\n    }\n}\n\nfunction waitForNavigation(): Promise<void> {\n    return new Promise<void>(resolve => {\n        function onCompleted(details: chrome.webNavigation.WebNavigationFramedCallbackDetails) {\n            if (details.frameId === 0) {\n                chrome.webNavigation.onCompleted.removeListener(onCompleted);\n                resolve();\n            }\n        }\n        chrome.webNavigation.onCompleted.addListener(onCompleted);\n    });\n}\n\n// This method listens for updates to tabs.\n// It is triggered every time a tab is updated, which can be caused by various events such as loading a page, changing the URL, the tab reloading, etc.\n// The listener receives the tabId, an object containing details about the change (changeInfo), and an object with info about the tab (tabInfo).\nchrome.tabs.onUpdated.addListener(async (tabId, changeInfo, tab) => {\n    if (changeInfo.status === \"complete\" && tab.active) {\n        // forward messages from the DOM window into the chrome runtime\n        await executeScript(tabId, () => {\n            window.addEventListener(\"message\", event => {\n                if (event.source === window && event.data.direction === \"syphonx\") {\n                    chrome.runtime.sendMessage({\n                        syphonx: (event as any).data.message\n                    });\n                }\n            });\n        });\n    }\n});\n\n// This method listens for messages that are sent from either content scripts or other parts of your extension (like a popup script or background script).\n// It's primarily used for inter-component communication within your extension.\n// This could include sending data between your background and content scripts, triggering specific actions in response to certain messages, etc.\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n    if (message.log) {\n        console.log(\"MESSAGE\", message.log);\n        return false; // immediate synchronous response\n    }\n\n    if (message.click) {\n        console.log(\"MESSAGE\", \"click\", { message, sender });\n        return false; // immediate synchronous response\n    }\n\n    if (typeof message.tabId !== \"number\") {\n        console.warn(\"MESSAGE\", message.key, { message, sender, error: `Property \"tabId\" is invalid: \"${message.tabId}\"` });\n        return false; // immediate synchronous response\n    }\n\n    if (message.key === \"navigate\") {\n        console.log(\"MESSAGE\", message.key, { message, sender });\n        (async () => {\n            await chrome.tabs.update({ url: message.params[0] });\n            await waitForNavigation();\n            sendResponse();\n        })();\n        return true; // response will be sent asynchronously\n    }\n    else if (message.key === \"reload\") {\n        console.log(\"MESSAGE\", message.key, { message, sender });\n        (async () => {\n            await chrome.tabs.reload();\n            await waitForNavigation();\n            sendResponse();\n        })();\n        return true; // response will be sent asynchronously\n    }\n    else if (message.key === \"tab\") {\n        (async () => {\n            const tab = await chrome.tabs.get(message.tabId);\n            sendResponse({ tab });\n            console.log(\"MESSAGE\", message.key, { message, sender, tab });\n        })();\n        return true; // response will be sent asynchronously\n    }\n    else if (!Object.keys(scripts).includes(message.key)) {\n        console.warn(\"MESSAGE\", { message, sender, error: `Property \"key\" is invalid: \"${message.key}\"` });\n        return false; // immediate synchronous response\n    }\n\n    (async () => {\n        try {\n            await injectAll(message.tabId);\n            const script = (scripts as unknown as Record<string, () => void>)[message.key];\n            const result = await executeScript(message.tabId, script, ...message.params);\n            //const result = await executeScript(message.tabId, scripts[message.key] as () => void, ...message.params);\n            console.log(\"MESSAGE\", message.key, { message, sender, result });\n            sendResponse({ result });\n        }\n        catch (error) {\n            console.error(\"MESSAGE\", message.key, { message, sender, error });\n            sendResponse({ error });\n        }\n    })();\n\n    return true; // response will be sent asynchronously\n});\n","export * from \"./queryTracking\";\nexport * from \"./selectElements\";\nexport * from \"./sliceHtml\";\nexport * from \"./tracking\";\n","export interface QueryTrackingOptions {\n    /**\n     * The class name of the element to target for which to find selectors.\n     */\n    className: string;\n    /**\n     * The maximum number of consecutive nth-of-type or first-of-type selectors allowed in a selector.\n     */\n    nthOfTypeRunLimit?: number;\n}\n\n/**\n * Finds an array of selectors that uniquely identify the element targeted by the specified className.\n * @param options The options for the query tracking.\n * @returns An array of selectors that uniquely identify the target element.\n */\nexport function queryTracking({ className, nthOfTypeRunLimit = 3 }: QueryTrackingOptions): string[] {\n    const result: string[] = [];\n    const targetElement = document.querySelector(`.${className}`);\n    if (targetElement) {\n        const closed: string[] = [];\n        let open: string[] = [];\n        let element: Element | null = targetElement;\n        while (element && element.tagName !== \"BODY\") {\n            const next = new Set<string>();\n\n            const tag = element.tagName.toLowerCase();\n            append(tag);\n\n            const id = element.getAttribute(\"id\");\n            if (id)\n                append(`#${id}`);\n\n            const classes = element.getAttribute(\"class\") ?\n                element.getAttribute(\"class\")!.split(\" \")\n                    .filter(name => name !== className) // filter out target class name\n                    .filter(name => /^-?[_a-z]+[_a-z0-9-]*$/i.test(name)) // filter out invalid class names\n                : [];\n            classes.forEach(name => append(`.${name}`));\n\n            const attributes = Array.from(element.attributes)\n                .filter(attr => ![\"id\", \"class\", \"style\", \"src\", \"href\", \"title\", \"lang\"].includes(attr.name))\n                .map(attr => ({ name: attr.name, value: attr.value }));\n            attributes.forEach(attr => append(`[${attr.name}${attr.value ? `='${attr.value.replace(/'/g, \"\\\\'\")}'` : \"\"}]`));\n\n            if (next.size === 0)\n                 break; // no more open paths so nothing left to do (shouldn't ever happen)\n\n            open = Array.from(next);\n            element = element.parentElement; // climb up the tree\n\n            // adds target to either closed or nextı\n            function append(target: string): void {\n                const paths = open.length > 0 ? open : [\"\"];\n                for (const path of paths) {\n                    const selector = path ? `${target} > ${path}` : target;\n                    const elements = Array.from(document.querySelectorAll(selector)) as Element[];\n                    // if selector is unique within the document and it matches the target element, then we are done\n                    if (elements.length === 1 && elements[0].isEqualNode(targetElement)) {\n                        // add selector to closed set\n                        closed.push(selector);\n                        // remove closed path from open set\n                        const i = open.indexOf(path);\n                        open.splice(i, 1);\n                    }\n                    // if target is a tag then add decorated node with nth-of-type to path\n                    else if (element?.parentElement && /^[a-z]+$/.test(target)) {\n                        const i = Array.from(element.parentElement.children)\n                            .filter(child => child.tagName.toLowerCase() === target)\n                            .findIndex(child => child.isEqualNode(element));\n                        if (i === 0)\n                            next.add(`${target}:first-of-type${path ? ` > ${path}` : \"\"}`);\n                        else if (i > 0)\n                            next.add(`${target}:nth-of-type(${i + 1})${path ? ` > ${path}` : \"\"}`);\n                    }\n                    // for all other selectors that are not a tag, we need to check if it matches the target element\n                    else if (element?.parentElement) {\n                        const elements = element.parentElement.querySelectorAll(selector);\n                        if (elements.length === 1 && elements[0].isEqualNode(targetElement))\n                            next.add(selector);\n                    }\n                }\n            }        \n        }\n\n        // attempt to reduce nth-of-type runs\n        const selectors = Array.from(new Set([...closed, ...open]));\n        for (let i = selectors.length - 1; i >= 0; --i) {\n            const selector1 = selectors[i];\n            if (/ > [a-z]+:(?:first-of-type|nth-of-type\\(\\d+\\)) > /.test(selector1)) {\n                const elements1 = document.querySelectorAll(selector1);\n                const selector2 = selector1.replace(/( > [a-z]+:(?:first-of-type|nth-of-type\\(\\d+\\)))+ > /g, \" \");\n                const elements2 = document.querySelectorAll(selector2);\n                if (elements1.length === elements2.length && elements1[0].isEqualNode(elements2[0])) {\n                    selectors.splice(i, 1, selector2);\n                }\n                else if (selectors.length > 1) {\n                    const hits = Array.from(selector1.matchAll(/( > [a-z]+:(?:first-of-type|nth-of-type\\(\\d+\\)))/g));\n                    if (hits.length - 1 > nthOfTypeRunLimit)\n                        selectors.splice(i, 1); // remove if run length exceeds limit, but don't remove the last selector\n                }\n            }\n        }\n\n        result.push(\n            ...Array.from(new Set(selectors))\n            .sort((a, b) =>\n                (a.match(/:nth-/g) || []).length - (b.match(/:nth-/g) || []).length ||\n                (a.match(/>/g) || []).length - (b.match(/>/g) || []).length ||\n                a.length - b.length ||\n                a.localeCompare(b)\n            )\n        );\n    }\n\n    return result;\n}\n","export interface SelectElementsOptions {\n    /**\n     * An array of CSS selectors that target the elements to select.\n     */\n    selectors: string[];\n    /**\n     * A class name that designates elements to appear as selected.\n     */\n    className: string;\n    /**\n     * The maximum number of elements to select.\n     */\n    limit?: number;\n    /**\n     * Whether to scroll the first selected element into view. Defaults to true.\n     */\n    scrollIntoView?: boolean;\n}\n\n/**\n * Adds the specified class to elements in the DOM that match a set of selectors.\n * @param options\n * @returns An array of strings containing the text content of the selected elements, or null if the element is not a text node.\n */\nexport function selectElements({ selectors, className, limit = 100, scrollIntoView = true } : SelectElementsOptions): Array<string | null> {\n    document.querySelectorAll(`.${className}`).forEach(element =>\n        element.classList.remove(className));\n\n    const result: Array<string | null> = [];\n    for (const selector of selectors)\n        if (selector && result.length <= limit)\n            document.querySelectorAll(selector).forEach(element => {\n                if (scrollIntoView) {\n                    setTimeout(() => {\n                        element.scrollIntoView({\n                            behavior: \"smooth\",\n                            block: \"center\",\n                            inline: \"center\"\n                        });    \n                    }, 500);\n                    scrollIntoView = false;\n                }\n                element.classList.add(className);\n                result.push(element.textContent);\n            });\n    \n    return result;\n}","export interface SliceHtmlOptions {\n    /**\n     * A CSS selector that targets the element for the HTML slice.\n     */\n    selector: string;\n    /**\n     * The number of parent elements to include in the slice.\n     */\n    up?: number;\n    /**\n     * The number of child elements to include in the slice.\n     */\n    down?: number;\n}\n\n/**\n * Slices the HTML document to include the specified element and its ancestors and descendants.\n * @param options The options for the HTML slice.\n * @returns A string containing the HTML slice.\n */\nexport function sliceHtml({ selector, up = 3, down = 3 }: SliceHtmlOptions): string {\n    const elements = mark();\n    const output: string[] = [];\n    render(document.documentElement);\n    unmark();\n    return output.join(\"\\n\");\n\n    function mark(): Element[] {\n        const elements = Array.from(document.querySelectorAll(selector));\n        for (const element of elements) {\n            element.setAttribute(\"marked\", \"\");\n            traverseUp(element);\n            if (element.parentElement)\n                traverseDown(element.parentElement);\n        }\n        return elements;\n    }\n\n    function unmark(): void {\n        document.querySelectorAll(\"[marked]\").forEach(element => element.removeAttribute(\"marked\"));\n    }\n\n    function traverseUp(element: Element, n = 0): void {\n        if (element.parentElement && n <= up) {\n            element.parentElement.setAttribute(\"marked\", \"\");\n            traverseUp(element.parentElement, n + 1);\n        }            \n    }\n    \n    function traverseDown(element: Element, level = Infinity, n = 0): void {\n        if (--level >= 0 && n <= down) {\n            for (const child of element.children) {\n                child.setAttribute(\"marked\", \"\");\n                traverseDown(child, level, n + 1);\n            }\n        }\n    }\n\n    function render(element: Element): void {\n        const tag = element.tagName.toLowerCase();\n        const exclude = [\"noscript\", \"script\", \"style\", \"svg\"];\n        const container = ![\"area\", \"base\", \"br\", \"col\", \"embed\", \"hr\", \"img\", \"input\", \"link\", \"meta\", \"param\", \"source\", \"track\", \"wbr\"].includes(tag);\n        const attributes = renderAttributes(element.attributes);\n        const marked = element.hasAttribute(\"marked\");\n        if (elements.includes(element) && marked) {\n            output.push(`<!---->`);\n        }\n        if (!container && marked) {\n            output.push(`<${tag}${attributes}>`);\n        }\n        else if (element.children.length > 0) {\n            if (marked)\n                output.push(`<${tag}${attributes}>`);\n            const children = Array.from(element.children)\n                .filter(child => !exclude.includes(child.tagName.toLocaleLowerCase()));\n            for (const child of children)\n                render(child);\n            if (marked)\n                output.push(`</${tag}>`);\n        }\n        else if (element.textContent !== null && element.textContent.trim().length > 0 && marked) {\n            const text = trunc(element.textContent.trim().replace(/\\s+/gm, \" \"));\n            output.push(`<${tag}${attributes}>${text}</${tag}>`);\n        }\n        else if (marked) {\n            output.push(`<${tag}${attributes}></${tag}>`);\n        }\n    \n        function renderAttributes(attributes: NamedNodeMap): string {\n            const text = Array.from(element.attributes)\n                .filter(attr => attr.value && attr.name !== \"marked\" && !attr.name.startsWith(\"sx-\"))\n                .map(attr => `${attr.name}=\"${trunc(attr.value.replace(/\"/g,'\\\"'))}\"`)\n                .join(\" \");\n            return text ? \" \" + text : \"\";\n        }\n    \n        function trunc(text: string, max = 80): string {\n            if (text.length > max) {\n                const k = Math.floor(max / 2);\n                const i = Math.max(text.slice(0, k).lastIndexOf(\" \"), k);\n                const j = Math.max(k - text.slice(-k).indexOf(\" \"), k);\n                text = text.slice(0, i) + \" … \" + text.slice(-j);\n            }\n            return text;\n        }\n    }\n}","export function disableTracking(): void {\n    syphonx.tracking = false;\n\n    document.querySelectorAll(\".sx-hover\").forEach(element => {\n        element.classList.remove(\"sx-hover\");\n        if (element.classList.length === 0)\n            element.removeAttribute(\"class\");\n    });\n\n    document.querySelectorAll(\".sx-click\").forEach(element => {\n        element.classList.remove(\"sx-click\");\n        if (element.classList.length === 0)\n            element.removeAttribute(\"class\");\n    });\n\n    if (syphonx.reset) {\n        syphonx.reset();\n        syphonx.reset = undefined;\n    }\n}\n\nexport function enableTracking(): void {\n    syphonx.tracking = true;\n\n    syphonx.reset = () => {\n        document.removeEventListener(\"click\", onClick);\n        document.removeEventListener(\"auxclick\", onClick);\n        document.removeEventListener(\"contextmenu\", onContext);\n        document.removeEventListener(\"mousemove\", onMouseMove);\n    };\n\n    document.addEventListener(\"click\", onClick);\n    document.addEventListener(\"auxclick\", onClick);\n    document.addEventListener(\"contextmenu\", onContext);\n    document.addEventListener(\"mousemove\", onMouseMove);\n\n    function onClick(event: MouseEvent): void {\n        document.querySelectorAll(\".sx-click\").forEach(element => {\n            element.classList.remove(\"sx-click\");\n            if (element.classList.length === 0)\n                element.removeAttribute(\"class\");\n        });\n\n        document.querySelectorAll(\".sx-hover\").forEach(element => {\n            element.classList.remove(\"sx-hover\");\n            if (element.classList.length === 0)\n                element.removeAttribute(\"class\");\n        });\n\n        if (syphonx.tracking) {\n            if (event.target instanceof HTMLElement) {\n                event.target.classList.add(\"sx-click\");\n                chrome.runtime.sendMessage({\n                    click: {\n                        altKey: event.altKey,\n                        button: event.button,\n                        ctrlKey: event.ctrlKey,\n                        shiftKey: event.shiftKey,\n                        x: event.x,\n                        y: event.y\n                    }\n                });\n            }\n            event.preventDefault();\n            event.stopPropagation();\n        }\n    }\n\n    function onContext(event: MouseEvent): void {\n        event.preventDefault();\n    }\n\n    function onMouseMove(event: MouseEvent): void {\n        document.querySelectorAll(\".sx-hover\").forEach(element => {\n            element.classList.remove(\"sx-hover\");\n            if (element.classList.length === 0)\n                element.removeAttribute(\"class\");\n        });\n\n        if (syphonx.tracking)\n            if (event.target instanceof HTMLElement)\n                event.target.classList.add(\"sx-hover\");\n    }\n}\n"],"names":[],"version":3,"file":"service_worker.js.map"}